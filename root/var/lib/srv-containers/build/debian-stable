FROM docker.io/debian:stable

LABEL description="base debian stable" maintainer="Pierre Dorgueil <pierre.dorgueil@gmail.com>"

# install addon software, enable system services, set passwords to 'debian'
RUN export DEBIAN_FRONTEND=noninteractive DEBCONF_NONINTERACTIVE_SEEN=true; \
printf 'tzdata tzdata/Areas select Etc\ntzdata tzdata/Zones/Etc select MET\n' | debconf-set-selections; \
    sed -i '/^path-exclude=.usr.share.man/s/^/# /' /etc/dpkg/dpkg.cfg.d/excludes 2>/dev/null; \
    apt-get update -qqy; \
    apt-get install -qqy --no-install-recommends \
      apt-file \
      bash-completion \
      cockpit \
      cockpit-packagekit \
      cockpit-ws \
      curl \
      dnsutils \
      less \
      locate \
      man \
      ncat \
      net-tools \
      network-manager \
      nmap \
      openssh-server \
      sudo \
      systemd-sysv \
      tzdata \
      vim \
      wget \
      ;\
    apt-get clean; \
    sed -i '/pam_systemd.so/s/^/# /' /etc/pam.d/common-session; \
    for s in cockpit ssh network-manager; do systemctl enable $s; done; \
    for u in getty.target console-getty.service getty@.service; do systemctl mask $u; done; \
    useradd -p '$6$srQnHfQoW9DyU0kG$MSSeTf.56NF.jJJAW3Abe2ZBIyYj.EwQ8rE7/sjPkf7B4c3VAG2M1CmuUXhWispp2Rytv5THn6CHLOEpYabXM0' -s /bin/bash app-adm; \
    usermod -p '$6$srQnHfQoW9DyU0kG$MSSeTf.56NF.jJJAW3Abe2ZBIyYj.EwQ8rE7/sjPkf7B4c3VAG2M1CmuUXhWispp2Rytv5THn6CHLOEpYabXM0' -s /bin/bash root; \
    echo "app-adm ALL=(ALL) NOPASSWD: ALL" > /etc/sudoers.d/app-adm

# allows for passwordless ssh access
COPY --chown=1000:1000 ./dot-ssh /home/app-adm/.ssh

CMD ["/sbin/init"]
